; Очистка памяти
RAM_Flush:	LDI		ZL,Low(SRAM_START)
			LDI		ZH,High(SRAM_START)
			CLR		R16
Flush:		ST 		Z+,R16
			CPI		ZH,High(RAMEND)
			BRNE	Flush

			CPI		ZL,Low(RAMEND)
			BRNE	Flush

			CLR		ZL
			CLR		ZH


;==================================================================================
; Init RTOS
;==================================================================================
			INIT_RTOS
;==================================================================================
; Инициализация периферии
;----------------------------------------------------------------------------------			
			OUTI	TIMSK,0<<TOIE0|1<<OCF2		; Разрешаем прерывание по переполнению Т0



			OUTI	DDRD,0xFF
			OUTI	PORTD,0x00

			CLR		OSRG
			STS		PovCT,OSRG

;====================================================================================
;Init SPI
;----------------------------------------------------------------------------------
			
			SBI		DDRB,5
			SBI		DDRB,3
			SBI		DDRB,2

			OUTI	SPCR,1<<SPE|1<<MSTR|0<<CPOL|0<<DORD|0<<SPR1|0<<SPR0


			CBI		PORTD,7
			NOP
			NOP
			SBI		PORTD,7

;==================================================================================
			USART_INIT

			LDI		OSRG,'A'
			STS		U_B,OSRG
